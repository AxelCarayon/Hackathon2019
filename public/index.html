<!doctype html>
<html>
  <meta charset="utf-8">
    <title>Application Hackathon</title>
    <meta name="description" content="???">
    <meta name="author" content="David Panzoli">
    
    <link rel = "stylesheet" type = "text/css" href = "config.css" />
    <link rel = "stylesheet" type = "text/css" href = "/packages/bootstrap/dist/css/bootstrap.css" />
    <script src="/packages/jquery/dist/jquery.min.js"></script>
    <script src="/packages/angular/angular.min.js"></script>
    <script src="/packages/bootstrap/dist/js/bootstrap.js"></script>
</head>
<body ng-app="gpecApp" ng-controller="controleur">
	<div class="container">
            <h1>Application client</h1>
            
            <form id='formulaireEmployes'>
                <select>
                    <div id="Employes"></div>
                    <div id='optionEmploye' style="display: none;">
                        <option><div id="EployeValue"></div></option>
                    </div>
                </select>
                <input type='submit' value='Chercher'>
            </form>
            
            
            <div id="timelineEvent">
                <!-- main timeline section -->
                <section id="cd-timeline" class="cd-container cssanimations">
                    <div id="event"></div>
                </section>
            </div>
	</div>
    </body>
    <div id="ajoutEvent" style="display: none;">
        <!-- single timeline event -->
        <div class="cd-timeline-block">
            <div class="cd-timeline-img cd-picture">
                <img src="event.png" />
            </div>
            <div class="cd-timeline-content">
                <h2 class='description'></h2>
                <div class='nom'></div>
                <div class='poste'></div>
                <div class='details'></div>
                <span class="cd-date"><div class='date'></div></span>
            </div>
        </div>
    </div>
    <script>
        //either use jQuery or AngularJS...
	$(document).ready(function() {
            $.ajax({
                method: 'GET',
                url: 'all_evenements',
		dataType: 'json',
                    success: function(dataC) {
                        $(dataC).each(function(k, v){
                            let nouv = $('#ajoutEvent').clone().css('display','block');
                            $(nouv).find('.description').text(v.description);
                            $(nouv).find('.nom').text(v.nom + " " + v.prenoms);
                            $(nouv).find('.poste').text(v.Poste); 
                            if(v.date_fin !== null){
                                $(nouv).find('.date').text(v.date_debut + " - " + v.date_fin); 
                            } else {
                                $(nouv).find('.date').text(v.date_debut); 
                            }      
                            
                            if(v.details !== null){
                                $(nouv).find('.details').text(v.details);
                            }
                
                            $(nouv).appendTo("#event");
                        });
                    },
                    error: function(x, error) {
                            console.log(error);
                        }
            });
            
            
            $.ajax({
                method: 'GET',
                url: 'personnels',
		dataType: 'json',
                    success: function(dataC) {
                        $(dataC).each(function(k, v){
                            let nouv =$('#optionEmploye').css("display", "block");
                            $(nouv).find('.EmployeValue').text(v.nom);
                            
                            $(nouv).appendTo("#Employes");
                        });
                    },
                    error: function(x, error) {
                            console.log(error);
                        }
            });
        });

        var app = angular.module('gpecApp', []);
		
        app.controller('controleur', function($scope, $http) {

            $http.get('/personnels').then(function(response) {
                $scope.personnels = response.data;
            });

        });


        $(window).on('scroll', function(){
            $('.cd-timeline-block').each(function(){
                if( $(this).offset().top <= $(window).scrollTop()+$(window).height()*0.75 && $(this).find('.cd-timeline-img').hasClass('is-hidden') ) {
                    $(this).find('.cd-timeline-img, .cd-timeline-content').removeClass('is-hidden').addClass('bounce-in');
                }
            });
        });
    </script>
</html>

